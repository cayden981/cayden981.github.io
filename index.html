<script type="text/python">
from browser import window, document, timer

THREE = window.THREE

# --- SCENE SETUP ---
scene = THREE.Scene.new()
camera = THREE.PerspectiveCamera.new(75, window.innerWidth/window.innerHeight, 0.1, 1000)
renderer = THREE.WebGLRenderer.new({"antialias": True})
renderer.setSize(window.innerWidth, window.innerHeight)
document.body.appendChild(renderer.domElement)

# --- THE FOREST BOUNDARY (The "Walls") ---
# 1. The Visual Wall (High Cylinder)
wall_geo = THREE.CylinderGeometry.new(50, 50, 60, 40, 1, True) # Radius 50
wall_mat = THREE.MeshPhongMaterial.new({
    "color": 0x132b0a, 
    "side": THREE.DoubleSide
})
forest_wall = THREE.Mesh.new(wall_geo, wall_mat)
forest_wall.position.y = 20 # Sits on the ground
scene.add(forest_wall)

# 2. The Floor
floor = THREE.Mesh.new(
    THREE.CircleGeometry.new(50, 40),
    THREE.MeshPhongMaterial.new({"color": 0x2d5a27})
)
floor.rotation.x = -1.57
scene.add(floor)

# --- PLAYER & MOVEMENT ---
player_mesh = THREE.Mesh.new(
    THREE.SphereGeometry.new(0.6, 16, 16),
    THREE.MeshPhongMaterial.new({"color": 0x7a5230})
)
scene.add(player_mesh)

pos = {"x": 0, "z": 0}
keys = {}

def on_keydown(ev): keys[ev.keyCode] = True
def on_keyup(ev): keys[ev.keyCode] = False
document.bind("keydown", on_keydown)
document.bind("keyup", on_keyup)

def update(t):
    speed = 0.25
    new_x = pos["x"]
    new_z = pos["z"]

    # Calculate intended move
    if 87 in keys: new_z -= speed # W
    if 83 in keys: new_z += speed # S
    if 65 in keys: new_x -= speed # A
    if 68 in keys: new_x += speed # D

    # --- COLLISION DETECTION (The Barrier) ---
    # Formula: distance = sqrt(x^2 + z^2)
    dist_from_center = (new_x**2 + new_z**2)**0.5
    
    # Radius of map is 50. If player is < 49, allow movement.
    if dist_from_center < 49:
        pos["x"] = new_x
        pos["z"] = new_z
    else:
        # If they hit the wall, nudge them back slightly so they don't get stuck
        pos["x"] *= 0.98
        pos["z"] *= 0.98

    player_mesh.position.set(pos["x"], 1, pos["z"])
    
    # Camera follows player
    camera.position.set(pos["x"], 5, pos["z"] + 10)
    camera.lookAt(player_mesh.position)

    renderer.render(scene, camera)
    window.requestAnimationFrame(update)

window.requestAnimationFrame(update)
# Add Lighting
sun = THREE.DirectionalLight.new(0xffffff, 1)
sun.position.set(10, 20, 10)
scene.add(sun)
scene.add(THREE.AmbientLight.new(0x404040))
</script>
